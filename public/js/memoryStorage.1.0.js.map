{"version":3,"file":"memoryStorage.1.0.js","sources":["../../src/memoryStorage/memoryStorage.js"],"sourcesContent":["const memoryStorage = new Object;\r\nconst setItem = (key, value) => {\r\n    sessionStorage.setItem(key, value);\r\n    localStorage.setItem('setItem', JSON.stringify({ key, value }));\r\n    localStorage.removeItem('setItem');\r\n}\r\n\r\nconst removeItem = (key) => {\r\n    sessionStorage.removeItem(key);\r\n    localStorage.setItem('removeItem', JSON.stringify({ key, value: Date.now() }));\r\n    localStorage.removeItem('removeItem');\r\n}\r\n\r\nconst getItem = (key) => {\r\n    return sessionStorage.getItem(key);\r\n}\r\n\r\nObject.defineProperty(memoryStorage, \"setItem\", {\r\n    configurable: false,\r\n    enumerable: false,\r\n    writable: false,\r\n    value: setItem,\r\n});\r\nObject.defineProperty(memoryStorage, \"removeItem\", {\r\n    configurable: false,\r\n    enumerable: false,\r\n    writable: false,\r\n    value: removeItem,\r\n});\r\nObject.defineProperty(memoryStorage, \"getItem\", {\r\n    configurable: false,\r\n    enumerable: false,\r\n    writable: false,\r\n    value: getItem,\r\n});\r\nif (!sessionStorage.length) {\r\n    // 这个调用能触发目标事件，从而达到共享数据的目的\r\n    localStorage.setItem('getSessionStorage', Date.now());\r\n    localStorage.removeItem('getSessionStorage');\r\n};\r\n// 该事件是核心\r\nwindow.addEventListener('storage', function (event) {\r\n    if (!event.newValue) {\r\n        return\r\n    }\r\n    if (event.key == 'getSessionStorage') {\r\n        // 已存在的标签页会收到这个事件\r\n        localStorage.setItem('sessionStorage', JSON.stringify(sessionStorage));\r\n        localStorage.removeItem('sessionStorage');\r\n    } else if (event.key == 'sessionStorage' && !sessionStorage.length) {\r\n        // 新开启的标签页会收到这个事件\r\n        let data = JSON.parse(event.newValue);\r\n        for (let key in data) {\r\n            sessionStorage.setItem(key, data[key]);\r\n        }\r\n    } else if (event.key == 'setItem') {\r\n        let data = JSON.parse(event.newValue);\r\n        sessionStorage.setItem(data.key, data.value);\r\n\r\n    } else if (event.key == 'removeItem') {\r\n        let data = JSON.parse(event.newValue);\r\n        sessionStorage.removeItem(data.key);\r\n\r\n    }\r\n});\r\n\r\nexport default memoryStorage;"],"names":["memoryStorage","Object","defineProperty","key","value","setItem","JSON","stringify","removeItem","Date","now","sessionStorage","getItem","length","window","addEventListener","event","newValue","data","parse"],"mappings":"yLAAA,IAAMA,EAAgB,IAAIC,cAiB1BA,OAAOC,eAAeF,EAAe,UAAW,eAC9B,cACF,YACF,QAnBE,SAACG,EAAKC,kBACHC,QAAQF,EAAKC,gBACfC,QAAQ,UAAWC,KAAKC,UAAU,CAAEJ,MAAKC,wBACzCI,WAAW,cAmB5BP,OAAOC,eAAeF,EAAe,aAAc,eACjC,cACF,YACF,QAnBK,SAACG,kBACDK,WAAWL,gBACbE,QAAQ,aAAcC,KAAKC,UAAU,CAAEJ,MAAKC,MAAOK,KAAKC,sBACxDF,WAAW,iBAmB5BP,OAAOC,eAAeF,EAAe,UAAW,eAC9B,cACF,YACF,QAnBE,SAACG,UACNQ,eAAeC,QAAQT,MAqB7BQ,eAAeE,sBAEHR,QAAQ,oBAAqBI,KAAKC,oBAClCF,WAAW,sBAG5BM,OAAOC,iBAAiB,UAAW,SAAUC,MACpCA,EAAMC,YAGM,qBAAbD,EAAMb,iBAEOE,QAAQ,iBAAkBC,KAAKC,UAAUI,8BACzCH,WAAW,uBACrB,GAAiB,kBAAbQ,EAAMb,KAA4BQ,eAAeE,QAMrD,GAAiB,WAAbG,EAAMb,IAAkB,KAC3Be,EAAOZ,KAAKa,MAAMH,EAAMC,yBACbZ,QAAQa,EAAKf,IAAKe,EAAKd,YAEnC,GAAiB,cAAbY,EAAMb,IAAqB,KAC9Be,EAAOZ,KAAKa,MAAMH,EAAMC,yBACbT,WAAWU,EAAKf,UAZiC,KAE5De,EAAOZ,KAAKa,MAAMH,EAAMC,cACvB,IAAId,KAAOe,iBACGb,QAAQF,EAAKe,EAAKf"}